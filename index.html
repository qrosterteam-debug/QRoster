<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QRoster - Attendance Made Easy</title>
  
  <!-- Html5 QR Code Scanner -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="topbar">
    <div class="left">
      <button id="menu-btn" class="icon-btn">â˜°</button>
      <h1 class="brand">QRoster</h1>
    </div>
    <div class="right">
      <span id="user-info"></span>
      <button id="login" class="primary">Login</button>
      <button id="register" class="primary">Register</button>
      <button id="logout" class="danger" style="display:none;">Logout</button>
    </div>
  </header>

  <div class="layout">
    <aside class="sidebar collapsed" id="sidebar">
      <div class="sidebar-inner">
        <img src="QRosterLogo.png" alt="QRoster Logo" class="sidebar-logo" onerror="this.style.display='none'" />
        <nav class="nav">
          <button class="nav-btn active tab" data-target="home-tab">ğŸ  Home</button>
          <button class="nav-btn tab" data-target="attendance-tab">ğŸ“‹ Take Attendance</button>
          <button class="nav-btn tab" data-target="history-tab">ğŸ“œ History</button>
        </nav>
      </div>
    </aside>

    <main class="content">
      <section id="home-tab" class="tab-content active">
        <div class="home-card">
          <img src="QRosterLogo.png" alt="QRoster Logo" class="home-logo" onerror="this.style.display='none'" />
          <h2>Welcome to QRoster</h2>
          <p>Modern QR-based attendance system for teachers. Fast, accurate, and easy to use.</p>
        </div>
      </section>

      <section id="attendance-tab" class="tab-content">
        <h2>Take Attendance</h2>

        <h3>Subjects</h3>
        <div id="subjects-container" class="subject-list"></div>

        <h3>Current Session: <span id="attendance-subject" style="color:var(--primary);font-weight:bold;">â€”</span></h3>

        <div id="attendance-summary">Select a subject to begin</div>

        <div style="text-align:center;">
          <button id="start-scan">ğŸ“· Start Scanner</button>
          <div id="qr-video"></div>
        </div>

        <table>
          <thead>
            <tr>
              <th>Student ID</th>
              <th>Name</th>
              <th>Section</th>
              <th>Status</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody id="attendance-body"></tbody>
        </table>

        <div style="margin-top:1.5rem;">
          <button id="finalize" class="primary">Finalize & Save Attendance</button>
          <button id="export-csv" class="success">Export as CSV</button>
        </div>
      </section>

      <section id="history-tab" class="tab-content">
        <h2>Attendance History</h2>
        <p>Your past finalized attendance records from Firebase Firestore. Click any to view details.</p>
        <div id="history-list">
          <div class="history-empty">
            <i class="fas fa-sign-in-alt" style="font-size:3rem;color:var(--gray);margin-bottom:1rem;"></i>
            <p>Please log in to view history.</p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <h3>Teacher Login</h3>
      <p>Please sign in to take and save attendance.</p>
      <input type="email" id="loginEmail" placeholder="Email address" required />
      <input type="password" id="loginPassword" placeholder="Password" required />
      <div class="modal-buttons">
        <button id="loginCancel">Cancel</button>
        <button id="loginSubmit" class="primary">Login</button>
      </div>
    </div>
  </div>

  <!-- Register Modal -->
  <div id="registerModal" class="modal">
    <div class="modal-content">
      <h3>Create Teacher Account</h3>
      <p>Please register to take and save attendance.</p>
      <input type="email" id="registerEmail" placeholder="Email address" required />
      <input type="password" id="registerPassword" placeholder="Password (6+ characters)" required />
      <div class="modal-buttons">
        <button id="registerCancel">Cancel</button>
        <button id="registerSubmit" class="primary">Register</button>
      </div>
    </div>
  </div>

  <!-- Finalize Modal -->
  <div id="finalizeModal" class="modal">
    <div class="modal-content">
      <h3>Finalize Attendance?</h3>
      <p>Once finalized, the record will be saved to Firebase Firestore and cannot be edited.</p>
      <p>Are you sure?</p>
      <div class="modal-buttons">
        <button id="finalizeCancel">Cancel</button>
        <button id="finalizeOk" class="primary">Yes, Finalize & Save</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <script type="module" src="app.js"></script>

  <script>
    document.getElementById('menu-btn').addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('collapsed');
    });
    document.querySelector('.content').addEventListener('click', () => {
      if (window.innerWidth <= 768) {
        document.getElementById('sidebar').classList.add('collapsed');
      }
    });
  </script>
</body>
</html>