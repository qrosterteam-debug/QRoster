<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>QRoster Dashboard</title>

  <!-- QR Scanner library -->
  <script src="https://unpkg.com/html5-qrcode@2.3.9/minified/html5-qrcode.min.js"></script>

  <!-- Bootstrap for UI + modal -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root {
      --primary: #1e3a8a;
      --secondary: #2563eb;
      --light: #f1f5f9;
    }
    body { font-family: "Segoe UI", Roboto, sans-serif; margin:0; background:var(--light); }
    /* Sidebar */
    .sidebar {
      width:240px; background:var(--primary); color:#fff;
      position:fixed; top:0; bottom:0; left:0;
      padding:20px; display:flex; flex-direction:column;
    }
    .sidebar h2 { font-size:18px; text-align:center; margin-bottom:20px; }
    .nav-link { color:#fff; opacity:0.9; padding:10px; border-radius:6px; text-decoration:none; margin-bottom:6px; }
    .nav-link:hover, .nav-link.active { background:#23407a; opacity:1; }
    .login-box { margin-top:auto; }
    .main { margin-left:240px; padding:20px; }

    /* Scanner */
    #qr-reader { width:100%; aspect-ratio:4/3; background:#000; border-radius:8px; position:relative; overflow:hidden; }
    #qr-reader video, #qr-reader canvas { width:100% !important; height:100% !important; object-fit:cover; }
    .scanner-frame {
      position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      width:70%; max-width:500px; aspect-ratio:3/1;
      border:3px solid rgba(255,255,255,0.95); border-radius:6px; pointer-events:none;
    }
    /* Stats */
    .stats { display:flex; gap:12px; flex-wrap:wrap; margin-bottom:16px; }
    .stat { background:#fff; padding:14px; border-radius:8px; text-align:center; flex:1; min-width:120px;
            box-shadow:0 4px 10px rgba(0,0,0,0.05); }
    .stat h3 { margin:0; font-size:20px; }

    /* Tables */
    table { background:#fff; border-radius:8px; overflow:hidden; }
    thead th { background:var(--primary); color:#fff; border:0; }

    @media(max-width:768px) {
      .sidebar { width:72px; padding:12px; }
      .sidebar h2 { display:none; }
      .main { margin-left:72px; }
      .nav-link { text-align:center; font-size:12px; padding:8px; }
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <h2>📋 QRoster</h2>
    <a href="#" class="nav-link active" data-tab="scanner">📷 QR Scanner</a>
    <a href="#" class="nav-link" data-tab="attendance">🧑‍🏫 Attendance List</a>
    <a href="#" class="nav-link" data-tab="history">📜 Attendance History</a>
    <div class="login-box mt-3">
      <p id="user-info" class="small"></p>
      <button id="login" class="btn btn-outline-light w-100 mb-2">Sign in with Google</button>
      <button id="logout" class="btn btn-light w-100 d-none">Logout</button>
    </div>
  </aside>

  <main class="main">
    <!-- Scanner Tab -->
    <section id="scanner" class="tab-pane">
      <h3>📷 QR Code Scanner</h3>
      <div id="qr-reader"><div class="scanner-frame"></div></div>
      <div class="d-flex gap-2 mt-2 flex-wrap">
        <select id="camera-select" class="form-select" style="max-width:320px;"></select>
        <button id="start-camera" class="btn btn-primary">Start</button>
        <button id="stop-camera" class="btn btn-secondary">Stop</button>
      </div>
      <p id="qr-reader-results" class="text-muted small mt-2"></p>
    </section>

    <!-- Attendance Tab -->
    <section id="attendance" class="tab-pane" style="display:none;">
      <h3>🧑‍🏫 Attendance List</h3>
      <div class="stats my-3">
        <div class="stat"><div>Total Students</div><h3 id="stat-total">0</h3></div>
        <div class="stat"><div>Present</div><h3 id="stat-present">0</h3></div>
        <div class="stat"><div>Absent</div><h3 id="stat-absent">0</h3></div>
      </div>
      <table class="table table-striped">
        <thead><tr><th>No.</th><th>Name</th><th>Status</th><th>Time</th></tr></thead>
        <tbody id="student-body"></tbody>
      </table>
      <button id="finalizeBtn" class="btn btn-success mt-3">Finalize Attendance</button>
    </section>

    <!-- History Tab -->
    <section id="history" class="tab-pane" style="display:none;">
      <h3>📜 Attendance History</h3>
      <table class="table table-bordered mt-3">
        <thead><tr><th>Date</th><th>Present</th><th>Absent</th><th>Saved at</th></tr></thead>
        <tbody id="historyTable"></tbody>
      </table>
    </section>
  </main>

  <!-- Finalize Modal -->
  <div class="modal fade" id="finalizeModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Finalize Attendance</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">Are you sure? Remaining students will be marked <b>Absent</b> and saved to History.</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button id="confirmFinalize" class="btn btn-primary">Yes, Finalize</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
