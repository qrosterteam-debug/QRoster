<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QRoster Dashboard</title>

  <!-- Html5 QR library -->
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

  <!-- Main styles (you already have style.css but keep this small helper) -->
  <link rel="stylesheet" href="style.css">

  <style>
    /* Small helpers used by layout ‚Äî your style.css remains primary */
    html,body { overflow-x:hidden; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    /* Frosted modal blur */
    .frosted-backdrop {
      position: fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background: rgba(8,12,20,0.35); backdrop-filter: blur(6px);
      z-index:9999; opacity:0; pointer-events:none; transition:opacity .22s;
    }
    .frosted-backdrop[data-open="true"] { opacity:1; pointer-events:auto; }
    .frosted-panel { background: rgba(255,255,255,0.82); border-radius:12px; padding:22px; width:92%; max-width:420px; box-shadow: 0 20px 50px rgba(6,20,40,0.25); transform:translateY(8px); transition:transform .22s; }
    .frosted-backdrop[data-open="true"] .frosted-panel { transform:none; }
    .login-google { display:flex; justify-content:center; }
    .small-muted { color:#556; font-size:13px; margin-top:8px; text-align:center; }

    /* Sidebar toggle button (3 dots) */
    .dots-toggle { background:transparent; border:none; font-size:22px; color:var(--text-on-primary,#fff); cursor:pointer; padding:8px; border-radius:8px; }
    /* small spinner */
    .spinner { width:28px; height:28px; border-radius:50%; border:4px solid rgba(0,0,0,0.08); border-top-color: #2b6cb0; animation:spin .9s linear infinite; display:inline-block; }
    @keyframes spin { to { transform: rotate(360deg) } }

    /* toast auto-dismiss */
    .toast { display:none; position:fixed; right:18px; bottom:18px; background: rgba(12,30,60,0.92); color:white; padding:10px 14px; border-radius:8px; z-index:80; }
    .toast.show { display:block; animation: fadeIn .18s; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(6px)} to { opacity:1; transform:none } }
  </style>
</head>
<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="left">
      <button id="sidebar-toggle" class="icon-btn dots-toggle" title="Toggle Menu">‚ãØ</button>
      <div class="brand" id="brand-text">QRoster</div>
    </div>
    <div class="right">
      <div id="top-actions"></div>
    </div>
  </div>

  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar collapsed" id="sidebar">
      <div class="sidebar-inner">
        <div class="sidebar-logo-wrap">
          <img id="qr-logo" class="sidebar-logo" src="QRosterLogo.png" alt="QRoster Logo" onerror="this.style.display='none'">
        </div>

        <!-- Nav -->
        <nav class="nav" id="nav">
          <button class="nav-btn active" data-tab="home">üè† Home</button>

          <!-- Subjects list (populated from app.js subjects array) -->
          <div class="subject-list" id="subject-list"></div>

          <!-- History tab (hidden until login) -->
          <button id="history-tab" class="nav-btn" data-tab="history" style="display:none">üìú Attendance History</button>
        </nav>

        <!-- bottom -->
        <div class="sidebar-bottom">
          <div id="user-info">Not signed in</div>
          <div class="login-actions" id="login-actions">
            <button id="login" class="primary">Sign in with Google</button>
            <button id="logout" class="primary" style="display:none">Logout</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="content">
      <!-- HOME -->
      <section id="home" class="tab-content active">
        <div class="home-card">
          <img id="home-logo" class="home-logo" src="QRosterLogo.png" alt="QRoster" onerror="this.style.display='none'">
          <h2>Welcome to QRoster</h2>
          <p class="small-muted">Manage subject-based attendance using QR codes. Login to start scanning and finalize attendance per subject.</p>
        </div>
      </section>

      <!-- Subject panels go here (created by app.js) -->
      <div id="subjects-container"></div>

      <!-- HISTORY -->
      <section id="history" class="tab-content">
        <div class="subject-panel">
          <div class="subject-header">
            <h3>Attendance History</h3>
            <div class="controls">
              <select id="history-subject-select"></select>
              <input id="history-date" type="date">
              <button id="history-show" class="primary">Show</button>
            </div>
          </div>

          <div id="history-spinner" style="display:none"><span class="spinner"></span> Loading...</div>
          <div id="history-results"></div>
        </div>
      </section>
    </main>
  </div>

  <!-- Finalize confirmation modal -->
  <div id="confirm-modal" class="modal" aria-hidden="true">
    <div class="modal-panel">
      <h3>Confirm Finalize</h3>
      <p>Are you sure you want to finalize attendance for this subject? This will save today's attendance (Present / Absent) to history.</p>
      <div class="modal-actions">
        <button id="cancel-finalize" class="primary">Cancel</button>
        <button id="confirm-finalize" class="danger">Yes, Finalize</button>
      </div>
    </div>
  </div>

  <!-- Login frosted modal (shown on first load if not signed in) -->
  <div id="login-frost" class="frosted-backdrop" data-open="false" aria-hidden="true">
    <div class="frosted-panel">
      <h3>Login with Google to continue</h3>
      <div class="login-google" style="margin-top:12px">
        <button id="modal-login" class="primary">Sign in with Google</button>
      </div>
      <p class="small-muted">Sign in with your school account to access scanning and history.</p>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- App script -->
  <script type="module" src="./app.js"></script>
</body>
</html>
